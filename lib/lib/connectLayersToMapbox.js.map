{"version":3,"sources":["../../src/lib/connectLayersToMapbox.js"],"names":["connectLayersToMapbox","WrappedComponent","MapboxLayerConnectedComponent","props","context","deleteMapboxLayer","bind","updateMapboxLayer","moveMapboxLayer","setLocals","nextProps","nextContext","mapboxLayerIndex","container","fullContainer","mapboxLayers","layers","fullmapboxLayers","getValObject","attr","updateContainer","deleteContainer","moveContainer","update","newUpdate","key","newkey","onUpdate","type","EDITOR_ACTIONS","DELETE_MAPBOXLAYER","payload","mapboxId","_subplot","id","direction","desiredIndex","MOVE_TO","fromIndex","toIndex","path","Component","displayName","propTypes","PropTypes","number","isRequired","contextTypes","object","data","array","func","childContextTypes","plotly_editor_traits"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {getDisplayName} from '../lib';\nimport {EDITOR_ACTIONS} from './constants';\n\nexport default function connectLayersToMapbox(WrappedComponent) {\n  class MapboxLayerConnectedComponent extends Component {\n    constructor(props, context) {\n      super(props, context);\n\n      this.deleteMapboxLayer = this.deleteMapboxLayer.bind(this);\n      this.updateMapboxLayer = this.updateMapboxLayer.bind(this);\n      this.moveMapboxLayer = this.moveMapboxLayer.bind(this);\n      this.setLocals(props, context);\n    }\n\n    componentWillReceiveProps(nextProps, nextContext) {\n      this.setLocals(nextProps, nextContext);\n    }\n\n    setLocals(props, context) {\n      const {mapboxLayerIndex} = props;\n      const {container, fullContainer} = context;\n\n      const mapboxLayers = container.layers || [];\n      const fullmapboxLayers = fullContainer.layers || [];\n      this.container = mapboxLayers[mapboxLayerIndex];\n      this.fullContainer = fullmapboxLayers[mapboxLayerIndex];\n    }\n\n    getChildContext() {\n      return {\n        getValObject: attr =>\n          !this.context.getValObject ? null : this.context.getValObject(`layers[].${attr}`),\n        updateContainer: this.updateMapboxLayer,\n        deleteContainer: this.deleteMapboxLayer,\n        moveContainer: this.moveMapboxLayer,\n        container: this.container,\n        fullContainer: this.fullContainer,\n      };\n    }\n\n    updateMapboxLayer(update) {\n      const newUpdate = {};\n      const {mapboxLayerIndex} = this.props;\n      for (const key in update) {\n        const newkey = `layers[${mapboxLayerIndex}].${key}`;\n        newUpdate[newkey] = update[key];\n      }\n      this.context.updateContainer(newUpdate);\n    }\n\n    deleteMapboxLayer() {\n      if (this.context.onUpdate) {\n        this.context.onUpdate({\n          type: EDITOR_ACTIONS.DELETE_MAPBOXLAYER,\n          payload: {\n            mapboxId: this.context.fullContainer._subplot.id,\n            mapboxLayerIndex: this.props.mapboxLayerIndex,\n          },\n        });\n      }\n    }\n\n    moveMapboxLayer(direction) {\n      if (this.context.onUpdate) {\n        const mapboxLayerIndex = this.props.mapboxLayerIndex;\n        const desiredIndex = direction === 'up' ? mapboxLayerIndex - 1 : mapboxLayerIndex + 1;\n        this.context.onUpdate({\n          type: EDITOR_ACTIONS.MOVE_TO,\n          payload: {\n            fromIndex: mapboxLayerIndex,\n            toIndex: desiredIndex,\n            mapboxId: this.context.fullContainer._subplot.id,\n            path: 'layout.mapbox.layers',\n          },\n        });\n      }\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} />;\n    }\n  }\n\n  MapboxLayerConnectedComponent.displayName = `MapboxLayerConnected${getDisplayName(\n    WrappedComponent\n  )}`;\n\n  MapboxLayerConnectedComponent.propTypes = {\n    mapboxLayerIndex: PropTypes.number.isRequired,\n  };\n\n  MapboxLayerConnectedComponent.contextTypes = {\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n    data: PropTypes.array,\n    onUpdate: PropTypes.func,\n    updateContainer: PropTypes.func,\n    getValObject: PropTypes.func,\n  };\n\n  MapboxLayerConnectedComponent.childContextTypes = {\n    updateContainer: PropTypes.func,\n    deleteContainer: PropTypes.func,\n    moveContainer: PropTypes.func,\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n    getValObject: PropTypes.func,\n  };\n\n  const {plotly_editor_traits} = WrappedComponent;\n  MapboxLayerConnectedComponent.plotly_editor_traits = plotly_editor_traits;\n\n  return MapboxLayerConnectedComponent;\n}\n"],"file":"connectLayersToMapbox.js"}