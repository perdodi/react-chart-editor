{"version":3,"sources":["../../../src/components/fields/TraceSelector.js"],"names":["TraceSelector","props","context","updatePlot","bind","setGl","glEnabled","setTraceDefaults","toggleGlControls","container","fullContainer","updateContainer","setLocals","state","showGlControls","type","endsWith","setState","_","localize","traceOptions","traceTypesConfig","traces","plotSchema","label","value","fullValue","gl","mode","glByDefault","nextProps","nextContext","traceType","slice","length","Object","assign","options","clearable","advancedTraceTypeSelector","display","width","alignItems","openModal","TraceTypeSelector","TRACES_WITH_GL","includes","Component","contextTypes","PropTypes","func","bool","object","config","propTypes","isRequired","any"],"mappings":"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","sourcesContent":["import {UnconnectedDropdown} from './Dropdown';\nimport PropTypes from 'prop-types';\nimport React, {Component} from 'react';\nimport {\n  connectToContainer,\n  traceTypeToPlotlyInitFigure,\n  plotlyTraceToCustomTrace,\n  computeTraceOptionsFromSchema,\n} from 'lib';\nimport {TRACES_WITH_GL} from 'lib/constants';\nimport {TraceTypeSelector, TraceTypeSelectorButton, RadioBlocks} from 'components/widgets';\nimport Field from './Field';\nimport {CogIcon} from 'plotly-icons';\n\nclass TraceSelector extends Component {\n  constructor(props, context) {\n    super(props, context);\n\n    this.updatePlot = this.updatePlot.bind(this);\n    this.setGl = this.setGl.bind(this);\n    this.glEnabled = this.glEnabled.bind(this);\n    this.setTraceDefaults = this.setTraceDefaults.bind(this);\n    this.toggleGlControls = this.toggleGlControls.bind(this);\n\n    this.setTraceDefaults(props.container, props.fullContainer, props.updateContainer);\n    this.setLocals(props, context);\n\n    this.state = {showGlControls: false};\n  }\n\n  glEnabled() {\n    return this.props.container.type && this.props.container.type.endsWith('gl') ? 'gl' : '';\n  }\n\n  toggleGlControls() {\n    this.setState({showGlControls: !this.state.showGlControls});\n  }\n\n  setLocals(props, context) {\n    const _ = context.localize;\n    if (props.traceOptions) {\n      this.traceOptions = props.traceOptions;\n    } else if (context.traceTypesConfig) {\n      this.traceOptions = context.traceTypesConfig.traces(_);\n    } else if (context.plotSchema) {\n      this.traceOptions = computeTraceOptionsFromSchema(context.plotSchema, _, this.context);\n    } else {\n      this.traceOptions = [{label: _('Scatter'), value: 'scatter'}];\n    }\n    if (props.container) {\n      this.fullValue = plotlyTraceToCustomTrace(props.container);\n    }\n  }\n\n  setTraceDefaults(container, fullContainer, updateContainer, gl) {\n    if (container && !container.mode && fullContainer.type === 'scatter') {\n      updateContainer({\n        type: 'scatter' + (gl || this.context.glByDefault ? gl : this.glEnabled()),\n        mode: fullContainer.mode || 'markers',\n      });\n    }\n  }\n\n  componentWillReceiveProps(nextProps, nextContext) {\n    const {container, fullContainer, updateContainer} = nextProps;\n    this.setTraceDefaults(container, fullContainer, updateContainer);\n    this.setLocals(nextProps, nextContext);\n  }\n\n  updatePlot(value) {\n    const {updateContainer} = this.props;\n    const {glByDefault} = this.context;\n    if (updateContainer) {\n      updateContainer(traceTypeToPlotlyInitFigure(value, this.glEnabled() || glByDefault));\n    }\n  }\n\n  setGl(value) {\n    const {container, fullContainer, updateContainer} = this.props;\n    const gl = 'gl';\n\n    this.setTraceDefaults(container, fullContainer, updateContainer, value);\n\n    const traceType =\n      this.fullValue.endsWith(gl) && value === ''\n        ? this.fullValue.slice(0, -gl.length)\n        : this.fullValue;\n\n    updateContainer(traceTypeToPlotlyInitFigure(traceType, value));\n  }\n\n  render() {\n    const props = Object.assign({}, this.props, {\n      fullValue: this.fullValue,\n      updatePlot: this.updatePlot,\n      options: this.traceOptions,\n      clearable: false,\n    });\n    const {localize: _, advancedTraceTypeSelector} = this.context;\n\n    const options = [\n      {label: _('SVG'), value: ''},\n      {label: _('WebGL'), value: 'gl'},\n    ];\n\n    // Check and see if the advanced selector prop is true\n    if (advancedTraceTypeSelector) {\n      return (\n        <div>\n          <Field {...props}>\n            <div\n              style={{\n                display: 'flex',\n                width: '100%',\n                alignItems: 'center',\n              }}\n            >\n              <TraceTypeSelectorButton\n                {...props}\n                traceTypesConfig={this.context.traceTypesConfig}\n                handleClick={() =>\n                  this.context.openModal(TraceTypeSelector, {\n                    ...props,\n                    traceTypesConfig: this.context.traceTypesConfig,\n                    glByDefault: this.context.glByDefault,\n                  })\n                }\n              />\n              {!TRACES_WITH_GL.includes(this.props.container.type) ? (\n                ''\n              ) : (\n                <CogIcon className=\"menupanel__icon\" onClick={this.toggleGlControls} />\n              )}\n            </div>\n          </Field>\n          {!(TRACES_WITH_GL.includes(this.props.container.type) && this.state.showGlControls) ? (\n            ''\n          ) : (\n            <Field label={_('Rendering')}>\n              <RadioBlocks\n                options={options}\n                activeOption={this.glEnabled()}\n                onOptionChange={this.setGl}\n              />\n            </Field>\n          )}\n        </div>\n      );\n    }\n\n    return <UnconnectedDropdown {...props} />;\n  }\n}\n\nTraceSelector.contextTypes = {\n  openModal: PropTypes.func,\n  advancedTraceTypeSelector: PropTypes.bool,\n  traceTypesConfig: PropTypes.object,\n  plotSchema: PropTypes.object,\n  config: PropTypes.object,\n  localize: PropTypes.func,\n  glByDefault: PropTypes.bool,\n};\n\nTraceSelector.propTypes = {\n  container: PropTypes.object.isRequired,\n  fullContainer: PropTypes.object.isRequired,\n  fullValue: PropTypes.any,\n  updateContainer: PropTypes.func,\n};\n\nexport default connectToContainer(TraceSelector);\n"],"file":"TraceSelector.js"}