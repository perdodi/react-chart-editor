{"version":3,"sources":["../../../src/components/fields/MarkerColor.js"],"names":["UnconnectedMarkerColor","props","context","type","container","marker","colorsrc","Array","isArray","color","fullContainer","state","value","constant","fullValue","COLORS","mutedBlue","variable","selectedConstantColorOption","multiValued","setType","bind","setColor","setColorScale","onConstantColorOptionChange","setState","updatePlot","updateContainer","colorscale","inputValue","includes","MULTI_VALUED","_","localize","attr","noSplitsPresent","transforms","filter","t","length","options","label","isMultiValued","renderConstantControls","renderVariableControls","Component","propTypes","PropTypes","any","func","Field","contextTypes","traceIndexes","array","object","displayName"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEMA,sB;;;;;AACJ,kCAAYC,KAAZ,EAAmBC,OAAnB,EAA4B;AAAA;;AAAA;;AAC1B,gGAAMD,KAAN,EAAaC,OAAb;AAEA,QAAIC,IAAI,GAAG,IAAX;;AACA,QAAI,CAACF,KAAK,CAACG,SAAN,CAAgBC,MAAjB,IAA4BJ,KAAK,CAACG,SAAN,CAAgBC,MAAhB,IAA0B,CAACJ,KAAK,CAACG,SAAN,CAAgBC,MAAhB,CAAuBC,QAAlF,EAA6F;AAC3FH,MAAAA,IAAI,GAAG,UAAP;AACD,KAFD,MAEO,IACLF,KAAK,CAACG,SAAN,CAAgBC,MAAhB,IACAE,KAAK,CAACC,OAAN,CAAcP,KAAK,CAACG,SAAN,CAAgBC,MAAhB,CAAuBI,KAArC,CADA,IAEAR,KAAK,CAACS,aAAN,CAAoBL,MAFpB,IAGAE,KAAK,CAACC,OAAN,CAAcP,KAAK,CAACS,aAAN,CAAoBL,MAApB,CAA2BI,KAAzC,CAJK,EAKL;AACAN,MAAAA,IAAI,GAAG,UAAP;AACD;;AAED,UAAKQ,KAAL,GAAa;AACXR,MAAAA,IAAI,EAAJA,IADW;AAEXS,MAAAA,KAAK,EAAE;AACLC,QAAAA,QAAQ,EAAEV,IAAI,KAAK,UAAT,GAAsBF,KAAK,CAACa,SAA5B,GAAwCC,kBAAOC,SADpD;AAELC,QAAAA,QAAQ,EAAEd,IAAI,KAAK,UAAT,GAAsBF,KAAK,CAACa,SAA5B,GAAwC;AAF7C,OAFI;AAMXI,MAAAA,2BAA2B,EAAEf,IAAI,KAAK,UAAT,IAAuBF,KAAK,CAACkB,WAA7B,GAA2C,UAA3C,GAAwD;AAN1E,KAAb;AASA,UAAKC,OAAL,GAAe,MAAKA,OAAL,CAAaC,IAAb,+BAAf;AACA,UAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcD,IAAd,+BAAhB;AACA,UAAKE,aAAL,GAAqB,MAAKA,aAAL,CAAmBF,IAAnB,+BAArB;AACA,UAAKG,2BAAL,GAAmC,MAAKA,2BAAL,CAAiCH,IAAjC,+BAAnC;AA3B0B;AA4B3B;;;;4BAEOlB,I,EAAM;AACZ,UAAI,KAAKQ,KAAL,CAAWR,IAAX,KAAoBA,IAAxB,EAA8B;AAC5B,aAAKsB,QAAL,CAAc;AAACtB,UAAAA,IAAI,EAAEA;AAAP,SAAd;AACA,aAAKF,KAAL,CAAWyB,UAAX,CAAsB,KAAKf,KAAL,CAAWC,KAAX,CAAiBT,IAAjB,CAAtB;;AACA,YAAIA,IAAI,KAAK,UAAb,EAAyB;AAAA;;AACvB,eAAKD,OAAL,CAAayB,eAAb,qEACG,iBADH,EACuB,IADvB,0CAEG,mBAFH,EAEyB,IAFzB,0CAGG,kBAHH,EAGwB,IAHxB;AAKA,eAAKF,QAAL,CAAc;AAACG,YAAAA,UAAU,EAAE;AAAb,WAAd;AACD,SAPD,MAOO;AAAA;;AACL,eAAK1B,OAAL,CAAayB,eAAb,uEACG,cADH,EACoB,IADpB,2CAEG,iBAFH,EAEuB,IAFvB,2CAGG,mBAHH,EAGyB,IAHzB;AAKD;AACF;AACF;;;6BAEQE,U,EAAY;AAAA,UACZ1B,IADY,GACJ,KAAKQ,KADD,CACZR,IADY;AAGnB,WAAKsB,QAAL,CACEtB,IAAI,KAAK,UAAT,GAAsB;AAACS,QAAAA,KAAK,EAAE;AAACC,UAAAA,QAAQ,EAAEgB;AAAX;AAAR,OAAtB,GAAwD;AAACjB,QAAAA,KAAK,EAAE;AAACK,UAAAA,QAAQ,EAAEY;AAAX;AAAR,OAD1D;AAGA,WAAK5B,KAAL,CAAWyB,UAAX,CAAsBG,UAAtB;AACD;;;kCAEaA,U,EAAY;AACxB,WAAKJ,QAAL,CAAc;AAACG,QAAAA,UAAU,EAAEC;AAAb,OAAd;AACA,WAAK3B,OAAL,CAAayB,eAAb,qBAA+B,mBAA/B,EAAqDE,UAArD;AACD;;;oCAEe;AACd,aACE,KAAK5B,KAAL,CAAWkB,WAAX,IACCZ,KAAK,CAACC,OAAN,CAAc,KAAKP,KAAL,CAAWa,SAAzB,KAAuC,KAAKb,KAAL,CAAWa,SAAX,CAAqBgB,QAArB,CAA8BC,uBAA9B,CADxC,IAEC,KAAK9B,KAAL,CAAWG,SAAX,CAAqBC,MAArB,IACC,KAAKJ,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BuB,UAD7B,IAEC,KAAK3B,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BuB,UAA5B,KAA2CG,uBAJ7C,IAKC,KAAK9B,KAAL,CAAWG,SAAX,CAAqBC,MAArB,IACC,KAAKJ,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BC,QAD7B,IAEC,KAAKL,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BC,QAA5B,KAAyCyB,uBAP3C,IAQC,KAAK9B,KAAL,CAAWG,SAAX,CAAqBC,MAArB,IACC,KAAKJ,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BI,KAD7B,IAECF,KAAK,CAACC,OAAN,CAAc,KAAKP,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BI,KAA1C,CAFD,IAGC,KAAKR,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BI,KAA5B,CAAkCqB,QAAlC,CAA2CC,uBAA3C,CAZJ;AAcD;;;gDAE2BnB,K,EAAO;AACjC,WAAKa,QAAL,CAAc;AACZP,QAAAA,2BAA2B,EAAEN;AADjB,OAAd;AAGD;;;6CAEwB;AACvB,UAAMoB,CAAC,GAAG,KAAK9B,OAAL,CAAa+B,QAAvB;AACA,aACE,6BAAC,yBAAD;AACE,QAAA,IAAI,EAAC,cADP;AAEE,QAAA,iBAAiB,EAAED,CAAC,CAAC,kEAAD,CAFtB;AAGE,QAAA,kBAAkB,EAAEA,CAAC,CAAC,mDAAD,CAHvB;AAIE,QAAA,QAAQ,EAAE,KAAKV,QAJjB;AAKE,QAAA,aAAa,EAAE,KAAKC,aALtB;AAME,QAAA,2BAA2B,EAAE,KAAKC,2BANpC;AAOE,QAAA,iCAAiC,EAAE,KAAKb,KAAL,CAAWO;AAPhD,QADF;AAWD;;;6CAEwB;AACvB,UAAMC,WAAW,GACf,KAAKlB,KAAL,CAAWG,SAAX,IACA,KAAKH,KAAL,CAAWG,SAAX,CAAqBC,MADrB,KAEE,KAAKJ,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BuB,UAA5B,IACA,KAAK3B,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BuB,UAA5B,KAA2CG,uBAD5C,IAEE,KAAK9B,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BC,QAA5B,IACC,KAAKL,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BC,QAA5B,KAAyCyB,uBAL7C,CADF;AAOA,aACE,6BAAC,cAAD;AAAO,QAAA,WAAW,EAAEZ;AAApB,SACE,6BAAC,qBAAD;AAAc,QAAA,0BAA0B,MAAxC;AAAyC,QAAA,IAAI,EAAC;AAA9C,QADF,EAEG,KAAKlB,KAAL,CAAWG,SAAX,CAAqBC,MAArB,IACD,KAAKJ,KAAL,CAAWG,SAAX,CAAqBC,MAArB,CAA4BuB,UAA5B,KAA2CG,uBAD1C,GACyD,IADzD,GAEC,6BAAC,yBAAD;AACE,QAAA,0BAA0B,MAD5B;AAEE,QAAA,IAAI,EAAC,mBAFP;AAGE,QAAA,UAAU,EAAE,KAAKR,aAHnB;AAIE,QAAA,UAAU,EAAE,KAAKZ,KAAL,CAAWiB;AAJzB,QAJJ,CADF;AAcD;;;6BAEQ;AAAA,UACAM,IADA,GACQ,KAAKjC,KADb,CACAiC,IADA;AAAA,0BAE0B,KAAKhC,OAF/B;AAAA,UAEU8B,CAFV,iBAEAC,QAFA;AAAA,UAEa7B,SAFb,iBAEaA,SAFb,EAIP;;AACA,UAAM+B,eAAe,GACnB/B,SAAS,KACR,CAACA,SAAS,CAACgC,UAAX,IAAyB,CAAChC,SAAS,CAACgC,UAAV,CAAqBC,MAArB,CAA4B,UAAAC,CAAC;AAAA,eAAIA,CAAC,CAACnC,IAAF,KAAW,SAAf;AAAA,OAA7B,EAAuDoC,MADzE,CADX;;AAIA,UAAIJ,eAAJ,EAAqB;AAAA,YACZhC,IADY,GACJ,KAAKQ,KADD,CACZR,IADY;AAEnB,YAAMqC,OAAO,GAAG,CACd;AAACC,UAAAA,KAAK,EAAET,CAAC,CAAC,UAAD,CAAT;AAAuBpB,UAAAA,KAAK,EAAE;AAA9B,SADc,EAEd;AAAC6B,UAAAA,KAAK,EAAET,CAAC,CAAC,UAAD,CAAT;AAAuBpB,UAAAA,KAAK,EAAE;AAA9B,SAFc,CAAhB;AAKA,eACE,4DACE,6BAAC,cAAD,eAAW,KAAKX,KAAhB;AAAuB,UAAA,IAAI,EAAEiC;AAA7B,YACE,6BAAC,cAAD;AAAO,UAAA,WAAW,EAAE,KAAKQ,aAAL,MAAwB,CAAC,KAAK/B,KAAL,CAAWR;AAAxD,WACE,6BAAC,oBAAD;AAAa,UAAA,OAAO,EAAEqC,OAAtB;AAA+B,UAAA,YAAY,EAAErC,IAA7C;AAAmD,UAAA,cAAc,EAAE,KAAKiB;AAAxE,UADF,EAGG,CAACjB,IAAD,GAAQ,IAAR,GACC,6BAAC,aAAD,QACGA,IAAI,KAAK,UAAT,GACG6B,CAAC,CAAC,sDAAD,CADJ,GAEGA,CAAC,CAAC,qDAAD,CAHP,CAJJ,CADF,EAaG,CAAC7B,IAAD,GACG,IADH,GAEGA,IAAI,KAAK,UAAT,GACA,KAAKwC,sBAAL,EADA,GAEA,KAAKC,sBAAL,EAjBN,CADF,EAoBGzC,IAAI,KAAK,UAAT,GAAsB,IAAtB,GACC,4DACE,6BAAC,cAAD;AACE,UAAA,KAAK,EAAE6B,CAAC,CAAC,sBAAD,CADV;AAEE,UAAA,IAAI,EAAC,qBAFP;AAGE,UAAA,OAAO,EAAE,CACP;AAACS,YAAAA,KAAK,EAAET,CAAC,CAAC,QAAD,CAAT;AAAqBpB,YAAAA,KAAK,EAAE;AAA5B,WADO,EAEP;AAAC6B,YAAAA,KAAK,EAAET,CAAC,CAAC,UAAD,CAAT;AAAuBpB,YAAAA,KAAK,EAAE;AAA9B,WAFO;AAHX,UADF,EASE,6BAAC,cAAD;AACE,UAAA,KAAK,EAAEoB,CAAC,CAAC,WAAD,CADV;AAEE,UAAA,IAAI,EAAC,kBAFP;AAGE,UAAA,OAAO,EAAE,CACP;AAACS,YAAAA,KAAK,EAAET,CAAC,CAAC,MAAD,CAAT;AAAmBpB,YAAAA,KAAK,EAAE;AAA1B,WADO,EAEP;AAAC6B,YAAAA,KAAK,EAAET,CAAC,CAAC,MAAD,CAAT;AAAmBpB,YAAAA,KAAK,EAAE;AAA1B,WAFO;AAHX,UATF,EAiBE,6BAAC,yBAAD;AACE,UAAA,KAAK,EAAEoB,CAAC,CAAC,kBAAD,CADV;AAEE,UAAA,IAAI,EAAC,cAFP;AAGE,UAAA,OAAO,EAAE,CACP;AAACS,YAAAA,KAAK,EAAET,CAAC,CAAC,MAAD,CAAT;AAAmBpB,YAAAA,KAAK,EAAE;AAA1B,WADO,EAEP;AAAC6B,YAAAA,KAAK,EAAET,CAAC,CAAC,QAAD,CAAT;AAAqBpB,YAAAA,KAAK,EAAE;AAA5B,WAFO,CAHX;AAOE,UAAA,MAAM,EAAE,KAPV;AAQE,UAAA,UAAU,EAAE;AARd,WAUE,6BAAC,gBAAD;AAAS,UAAA,KAAK,EAAEoB,CAAC,CAAC,KAAD,CAAjB;AAA0B,UAAA,IAAI,EAAC;AAA/B,UAVF,EAWE,6BAAC,gBAAD;AAAS,UAAA,KAAK,EAAEA,CAAC,CAAC,KAAD,CAAjB;AAA0B,UAAA,IAAI,EAAC;AAA/B,UAXF,CAjBF,CArBJ,CADF;AAwDD;;AAED,aACE,6BAAC,cAAD,eAAW,KAAK/B,KAAhB;AAAuB,QAAA,IAAI,EAAEiC;AAA7B,UACG,KAAKS,sBAAL,EADH,CADF;AAKD;;;;EA/MkCE,gB;;AAkNrC7C,sBAAsB,CAAC8C,SAAvB;AACEhC,EAAAA,SAAS,EAAEiC,mBAAUC,GADvB;AAEEtB,EAAAA,UAAU,EAAEqB,mBAAUE;AAFxB,GAGKC,eAAMJ,SAHX;AAMA9C,sBAAsB,CAACmD,YAAvB,GAAsC;AACpClB,EAAAA,QAAQ,EAAEc,mBAAUE,IADgB;AAEpCtB,EAAAA,eAAe,EAAEoB,mBAAUE,IAFS;AAGpCG,EAAAA,YAAY,EAAEL,mBAAUM,KAHY;AAIpCjD,EAAAA,SAAS,EAAE2C,mBAAUO;AAJe,CAAtC;AAOAtD,sBAAsB,CAACuD,WAAvB,GAAqC,wBAArC;;eAEe,6BAAmBvD,sBAAnB,C","sourcesContent":["import Field from './Field';\nimport PropTypes from 'prop-types';\nimport React, {Component} from 'react';\nimport {connectToContainer} from 'lib';\nimport RadioBlocks from '../widgets/RadioBlocks';\nimport MultiColorPicker from './MultiColorPicker';\nimport ColorscalePicker from './ColorscalePicker';\nimport Numeric from './Numeric';\nimport Radio from './Radio';\nimport Info from './Info';\nimport DataSelector from './DataSelector';\nimport VisibilitySelect from './VisibilitySelect';\nimport {MULTI_VALUED, COLORS} from 'lib/constants';\n\nclass UnconnectedMarkerColor extends Component {\n  constructor(props, context) {\n    super(props, context);\n\n    let type = null;\n    if (!props.container.marker || (props.container.marker && !props.container.marker.colorsrc)) {\n      type = 'constant';\n    } else if (\n      props.container.marker &&\n      Array.isArray(props.container.marker.color) &&\n      props.fullContainer.marker &&\n      Array.isArray(props.fullContainer.marker.color)\n    ) {\n      type = 'variable';\n    }\n\n    this.state = {\n      type,\n      value: {\n        constant: type === 'constant' ? props.fullValue : COLORS.mutedBlue,\n        variable: type === 'variable' ? props.fullValue : null,\n      },\n      selectedConstantColorOption: type === 'constant' && props.multiValued ? 'multiple' : 'single',\n    };\n\n    this.setType = this.setType.bind(this);\n    this.setColor = this.setColor.bind(this);\n    this.setColorScale = this.setColorScale.bind(this);\n    this.onConstantColorOptionChange = this.onConstantColorOptionChange.bind(this);\n  }\n\n  setType(type) {\n    if (this.state.type !== type) {\n      this.setState({type: type});\n      this.props.updatePlot(this.state.value[type]);\n      if (type === 'constant') {\n        this.context.updateContainer({\n          ['marker.colorsrc']: null,\n          ['marker.colorscale']: null,\n          ['marker.showscale']: null,\n        });\n        this.setState({colorscale: null});\n      } else {\n        this.context.updateContainer({\n          ['marker.color']: null,\n          ['marker.colorsrc']: null,\n          ['marker.colorscale']: null,\n        });\n      }\n    }\n  }\n\n  setColor(inputValue) {\n    const {type} = this.state;\n\n    this.setState(\n      type === 'constant' ? {value: {constant: inputValue}} : {value: {variable: inputValue}}\n    );\n    this.props.updatePlot(inputValue);\n  }\n\n  setColorScale(inputValue) {\n    this.setState({colorscale: inputValue});\n    this.context.updateContainer({['marker.colorscale']: inputValue});\n  }\n\n  isMultiValued() {\n    return (\n      this.props.multiValued ||\n      (Array.isArray(this.props.fullValue) && this.props.fullValue.includes(MULTI_VALUED)) ||\n      (this.props.container.marker &&\n        this.props.container.marker.colorscale &&\n        this.props.container.marker.colorscale === MULTI_VALUED) ||\n      (this.props.container.marker &&\n        this.props.container.marker.colorsrc &&\n        this.props.container.marker.colorsrc === MULTI_VALUED) ||\n      (this.props.container.marker &&\n        this.props.container.marker.color &&\n        Array.isArray(this.props.container.marker.color) &&\n        this.props.container.marker.color.includes(MULTI_VALUED))\n    );\n  }\n\n  onConstantColorOptionChange(value) {\n    this.setState({\n      selectedConstantColorOption: value,\n    });\n  }\n\n  renderConstantControls() {\n    const _ = this.context.localize;\n    return (\n      <MultiColorPicker\n        attr=\"marker.color\"\n        multiColorMessage={_('Each trace will be colored according to the selected colorscale.')}\n        singleColorMessage={_('All traces will be colored in the the same color.')}\n        setColor={this.setColor}\n        setColorScale={this.setColorScale}\n        onConstantColorOptionChange={this.onConstantColorOptionChange}\n        parentSelectedConstantColorOption={this.state.selectedConstantColorOption}\n      />\n    );\n  }\n\n  renderVariableControls() {\n    const multiValued =\n      this.props.container &&\n      this.props.container.marker &&\n      ((this.props.container.marker.colorscale &&\n        this.props.container.marker.colorscale === MULTI_VALUED) ||\n        (this.props.container.marker.colorsrc &&\n          this.props.container.marker.colorsrc === MULTI_VALUED));\n    return (\n      <Field multiValued={multiValued}>\n        <DataSelector suppressMultiValuedMessage attr=\"marker.color\" />\n        {this.props.container.marker &&\n        this.props.container.marker.colorscale === MULTI_VALUED ? null : (\n          <ColorscalePicker\n            suppressMultiValuedMessage\n            attr=\"marker.colorscale\"\n            updatePlot={this.setColorScale}\n            colorscale={this.state.colorscale}\n          />\n        )}\n      </Field>\n    );\n  }\n\n  render() {\n    const {attr} = this.props;\n    const {localize: _, container} = this.context;\n\n    // TO DO: https://github.com/plotly/react-chart-editor/issues/654\n    const noSplitsPresent =\n      container &&\n      (!container.transforms || !container.transforms.filter(t => t.type === 'groupby').length);\n\n    if (noSplitsPresent) {\n      const {type} = this.state;\n      const options = [\n        {label: _('Constant'), value: 'constant'},\n        {label: _('Variable'), value: 'variable'},\n      ];\n\n      return (\n        <>\n          <Field {...this.props} attr={attr}>\n            <Field multiValued={this.isMultiValued() && !this.state.type}>\n              <RadioBlocks options={options} activeOption={type} onOptionChange={this.setType} />\n\n              {!type ? null : (\n                <Info>\n                  {type === 'constant'\n                    ? _('All points in a trace are colored in the same color.')\n                    : _('Each point in a trace is colored according to data.')}\n                </Info>\n              )}\n            </Field>\n\n            {!type\n              ? null\n              : type === 'constant'\n              ? this.renderConstantControls()\n              : this.renderVariableControls()}\n          </Field>\n          {type === 'constant' ? null : (\n            <>\n              <Radio\n                label={_('Colorscale Direction')}\n                attr=\"marker.reversescale\"\n                options={[\n                  {label: _('Normal'), value: false},\n                  {label: _('Reversed'), value: true},\n                ]}\n              />\n              <Radio\n                label={_('Color Bar')}\n                attr=\"marker.showscale\"\n                options={[\n                  {label: _('Show'), value: true},\n                  {label: _('Hide'), value: false},\n                ]}\n              />\n              <VisibilitySelect\n                label={_('Colorscale Range')}\n                attr=\"marker.cauto\"\n                options={[\n                  {label: _('Auto'), value: true},\n                  {label: _('Custom'), value: false},\n                ]}\n                showOn={false}\n                defaultOpt={true}\n              >\n                <Numeric label={_('Min')} attr=\"marker.cmin\" />\n                <Numeric label={_('Max')} attr=\"marker.cmax\" />\n              </VisibilitySelect>\n            </>\n          )}\n        </>\n      );\n    }\n\n    return (\n      <Field {...this.props} attr={attr}>\n        {this.renderConstantControls()}\n      </Field>\n    );\n  }\n}\n\nUnconnectedMarkerColor.propTypes = {\n  fullValue: PropTypes.any,\n  updatePlot: PropTypes.func,\n  ...Field.propTypes,\n};\n\nUnconnectedMarkerColor.contextTypes = {\n  localize: PropTypes.func,\n  updateContainer: PropTypes.func,\n  traceIndexes: PropTypes.array,\n  container: PropTypes.object,\n};\n\nUnconnectedMarkerColor.displayName = 'UnconnectedMarkerColor';\n\nexport default connectToContainer(UnconnectedMarkerColor);\n"],"file":"MarkerColor.js"}